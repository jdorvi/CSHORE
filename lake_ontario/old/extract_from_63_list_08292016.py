# -*- coding: utf-8 - Python 2.7.11 *-
"""
Description: Reads Adcirc Global Output file fort.63 & returns time series at
selected nodes.
Input(s): fort.63, Nodes of interest
Output(s): Time series .txt files
jdorvinen@dewberry.com, slawler@dewberry.com
Created on Tue Apr 19 15:08:33 2016
"""
#------------Load Python Modules--------------------#
#import fileinput
from datetime import datetime as dt
import os

#------------User Inputs----------------------------#
PARENT_DIR = "/media/sf_P_DRIVE/02/LakeOntario/Storm/"
INPUTFILES = ["fort.63", "swan_TP.63", "swan_HS.63"]
STORM_LIST = ["19740314", "19770107", "19800109", "20061026"]
NODES_LIST = {"23102":["Transect_123"], "23286":["Transect_124"], "23383":["Transect_125"],
              "23381":["Transect_126"], "23675":["Transect_127"], "23765":["Transect_128"],
              "24208":["Transect_129"], "24593":["Transect_130"], "25336":["Transect_131"],
              "25335":["Transect_132"], "24823":["Transect_133"], "26710":["Transect_134"],
              "26169":["Transect_135"], "27445":["Transect_136"], "28109":["Transect_137"],
              "27202":["Transect_138"], "30218":["Transect_139"], "30541":["Transect_140"],
              "28940":["Transect_141"], "29588":["Transect_142"], "29247":["Transect_143"],
              "30848":["Transect_144"], "30498":["Transect_145"], "30175":["Transect_146"],
              "29863":["Transect_147"], "32310":["Transect_148"], "33843":["Transect_149"],
              "35778":["Transect_150"], "36884":["Transect_151"], "38175":["Transect_152"],
              "40381":["Transect_153"], "42628":["Transect_154"], "47508":["Transect_155"],
              "51576":["Transect_156"], "53392":["Transect_157"], "57093":["Transect_158"],
              "58648":["Transect_159"], "59231":["Transect_160"], "62174":["Transect_161"],
              "64925":["Transect_162"],"64923":["Transect_163"],"61564":["Transect_164"],"62156":["Transect_165"],"62150":["Transect_166"],"60377":["Transect_167"],"59809":["Transect_168"],"59801":["Transect_169"],"60943":["Transect_170"],"57075":["Transect_171"],"55043":["Transect_172"],"55040":["Transect_173"],"54226":["Transect_174"],"57061":["Transect_175"],"58614":["Transect_176"],"60346":["Transect_177"],"58607":["Transect_178"],"55019":["Transect_179"],"53361":["Transect_180"],"49856":["Transect_181"],"46071":["Transect_182"],"49850":["Transect_183"],"53358":["Transect_184"],"55013":["Transect_185"],"55822":["Transect_186"],"56464":["Transect_187"],"55819":["Transect_188"],"54200":["Transect_189"],"52461":["Transect_190"],"50670":["Transect_191"],"49839":["Transect_192"],"47480":["Transect_193"],"46763":["Transect_194"],"44642":["Transect_195"],"43950":["Transect_196"],"41423":["Transect_197"],"40373":["Transect_198"],"39882":["Transect_199"],"38550":["Transect_200"],"37815":["Transect_201"],"37485":["Transect_202"],"37805":["Transect_203"],"37802":["Transect_204"],"38533":["Transect_205"],"39390":["Transect_206"],"38151":["Transect_207"],"37471":["Transect_208"],"38915":["Transect_209"],"40357":["Transect_210"],"40874":["Transect_211"],"42606":["Transect_212"],"44637":["Transect_213"],"45349":["Transect_214"],"47472":["Transect_215"],"48228":["Transect_216"],"51527":["Transect_217"],"55811":["Transect_218"],"56452":["Transect_219"],"55807":["Transect_220"],"56443":["Transect_221"],"57018":["Transect_222"],"57015":["Transect_223"],"54181":["Transect_224"],"50654":["Transect_225"],"48223":["Transect_226"],"46753":["Transect_227"],"44632":["Transect_228"],"43264":["Transect_229"],"41975":["Transect_230"],"41975":["Transect_231"],"40352":["Transect_232"],"39365":["Transect_233"],"38514":["Transect_234"],"40339":["Transect_235"],"41389":["Transect_236"],"42581":["Transect_237"],"41383":["Transect_238"],"43234":["Transect_239"],"41955":["Transect_240"],"45321":["Transect_241"],"45319":["Transect_242"],"44606":["Transect_243"],"43900":["Transect_244"],"43225":["Transect_245"],"42564":["Transect_246"],"42561":["Transect_247"],"41367":["Transect_248"],"41365":["Transect_249"],"41362":["Transect_250"],"41360":["Transect_251"],"41358":["Transect_252"],"41923":["Transect_253"],"41922":["Transect_254"],"42536":["Transect_255"],"42534":["Transect_256"],"42532":["Transect_257"],"43213":["Transect_258"],"44595":["Transect_259"],"49000":["Transect_260"],"44591":["Transect_261"],"44588":["Transect_262"],"45999":["Transect_263"],"44583":["Transect_264"],"41346":["Transect_265"],"39813":["Transect_266"],"38876":["Transect_267"],"37137":["Transect_268"],"35748":["Transect_269"],"35466":["Transect_270"],"35191":["Transect_271"],"34635":["Transect_272"],"34629":["Transect_273"],"31526":["Transect_274"],"28599":["Transect_275"],"28885":["Transect_276"],"30779":["Transect_277"],"33769":["Transect_278"],"33808":["Transect_279"],"34871":["Transect_280"],"34891":["Transect_281"],"36283":["Transect_282"],"36007":["Transect_283"],"37425":["Transect_284"],"38094":["Transect_285"],"39310":["Transect_286"],"39797":["Transect_287"],"43190":["Transect_288"],"41317":["Transect_289"],"40793":["Transect_290"],"41318":["Transect_291"],"41318":["Transect_292"],"41314":["Transect_293"],"40783":["Transect_294"],"40782":["Transect_295"],"40271":["Transect_296"],"40778":["Transect_297"],"41302":["Transect_298"],"41852":["Transect_299"],"43820":["Transect_300"],"42454":["Transect_301"],"42452":["Transect_302"],"43137":["Transect_303"],"108146":["Transect_304"],"23101":["Transect_123"],"23193":["Transect_124"],"23284":["Transect_125"],"23482":["Transect_126"],"23676":["Transect_127"],"23857":["Transect_128"],"24134":["Transect_129"],"24518":["Transect_130"],"25236":["Transect_131"],"25235":["Transect_132"],"24744":["Transect_133"],"26861":["Transect_134"],"26167":["Transect_135"],"27667":["Transect_136"],"27878":["Transect_137"],"27020":["Transect_138"],"30211":["Transect_139"],"30879":["Transect_140"],"29257":["Transect_141"],"29257":["Transect_142"],"29577":["Transect_143"],"30504":["Transect_144"],"30841":["Transect_145"],"30495":["Transect_146"],"30168":["Transect_147"],"32309":["Transect_148"],"33507":["Transect_149"],"35779":["Transect_150"],"36885":["Transect_151"],"38176":["Transect_152"],"39890":["Transect_153"],"41995":["Transect_154"],"47509":["Transect_155"],"52507":["Transect_156"],"53393":["Transect_157"],"56525":["Transect_158"],"58649":["Transect_159"],"59831":["Transect_160"],"61571":["Transect_161"],"64192":["Transect_162"],"64924":["Transect_163"],"61563":["Transect_164"],"62157":["Transect_165"],"62151":["Transect_166"],"60959":["Transect_167"],"59810":["Transect_168"],"59802":["Transect_169"],"60944":["Transect_170"],"57583":["Transect_171"],"55857":["Transect_172"],"55039":["Transect_173"],"55034":["Transect_174"],"57577":["Transect_175"],"58615":["Transect_176"],"59784":["Transect_177"],"58608":["Transect_178"],"55830":["Transect_179"],"52477":["Transect_180"],"50687":["Transect_181"],"46070":["Transect_182"],"49849":["Transect_183"],"52472":["Transect_184"],"55012":["Transect_185"],"56466":["Transect_186"],"56463":["Transect_187"],"55007":["Transect_188"],"54199":["Transect_189"],"53347":["Transect_190"],"50669":["Transect_191"],"49027":["Transect_192"],"47479":["Transect_193"],"46057":["Transect_194"],"45354":["Transect_195"],"43276":["Transect_196"],"41984":["Transect_197"],"40890":["Transect_198"],"39402":["Transect_199"],"38172":["Transect_200"],"37816":["Transect_201"],"37171":["Transect_202"],"37806":["Transect_203"],"37803":["Transect_204"],"38933":["Transect_205"],"38932":["Transect_206"],"38532":["Transect_207"],"37795":["Transect_208"],"39370":["Transect_209"],"39860":["Transect_210"],"40355":["Transect_211"],"41979":["Transect_212"],"43947":["Transect_213"],"46051":["Transect_214"],"47473":["Transect_215"],"49016":["Transect_216"],"50663":["Transect_217"],"54998":["Transect_218"],"57028":["Transect_219"],"56448":["Transect_220"],"56442":["Transect_221"],"57531":["Transect_222"],"57014":["Transect_223"],"54180":["Transect_224"],"50655":["Transect_225"],"47466":["Transect_226"],"46047":["Transect_227"],"45342":["Transect_228"],"42601":["Transect_229"],"41976":["Transect_230"],"41976":["Transect_231"],"40351":["Transect_232"],"39364":["Transect_233"],"38513":["Transect_234"],"40856":["Transect_235"],"40854":["Transect_236"],"41958":["Transect_237"],"41954":["Transect_238"],"42573":["Transect_239"],"42579":["Transect_240"],"44610":["Transect_241"],"44608":["Transect_242"],"45316":["Transect_243"],"44604":["Transect_244"],"43224":["Transect_245"],"43223":["Transect_246"],"42562":["Transect_247"],"40833":["Transect_248"],"41364":["Transect_249"],"41930":["Transect_250"],"41927":["Transect_251"],"41925":["Transect_252"],"41357":["Transect_253"],"41921":["Transect_254"],"42537":["Transect_255"],"41919":["Transect_256"],"43213":["Transect_257"],"43212":["Transect_258"],"44594":["Transect_259"],"49822":["Transect_260"],"44590":["Transect_261"],"45300":["Transect_262"],"46722":["Transect_263"],"44584":["Transect_264"],"40816":["Transect_265"],"40305":["Transect_266"],"38482":["Transect_267"],"37136":["Transect_268"],"35474":["Transect_269"],"35467":["Transect_270"],"34908":["Transect_271"],"34634":["Transect_272"],"34628":["Transect_273"],"31150":["Transect_274"],"28323":["Transect_275"],"28585":["Transect_276"],"30778":["Transect_277"],"34052":["Transect_278"],"34088":["Transect_279"],"34872":["Transect_280"],"35177":["Transect_281"],"36008":["Transect_282"],"36282":["Transect_283"],"37747":["Transect_284"],"38470":["Transect_285"],"39311":["Transect_286"],"39796":["Transect_287"],"42497":["Transect_288"],"41316":["Transect_289"],"40794":["Transect_290"],"40790":["Transect_291"],"40790":["Transect_292"],"40787":["Transect_293"],"40275":["Transect_294"],"40273":["Transect_295"],"40780":["Transect_296"],"40779":["Transect_297"],"40777":["Transect_298"],"41851":["Transect_299"],"43821":["Transect_300"],"42453":["Transect_301"],"43138":["Transect_302"],"43812":["Transect_303"],"107191":["Transect_304"],"23194":["Transect_123"],"23192":["Transect_124"],"23382":["Transect_125"],"23483":["Transect_126"],"23578":["Transect_127"],"23858":["Transect_128"],"24207":["Transect_129"],"24517":["Transect_130"],"25235":["Transect_131"],"25334":["Transect_132"],"24743":["Transect_133"],"26862":["Transect_134"],"26300":["Transect_135"],"27668":["Transect_136"],"27871":["Transect_137"],"27201":["Transect_138"],"30533":["Transect_139"],"30880":["Transect_140"],"29258":["Transect_141"],"29256":["Transect_142"],"29578":["Transect_143"],"30847":["Transect_144"],"30499":["Transect_145"],"30496":["Transect_146"],"30169":["Transect_147"],"32717":["Transect_148"],"33842":["Transect_149"],"35501":["Transect_150"],"36610":["Transect_151"],"37820":["Transect_152"],"39889":["Transect_153"],"42627":["Transect_154"],"46788":["Transect_155"],"51577":["Transect_156"],"52509":["Transect_157"],"56524":["Transect_158"],"58112":["Transect_159"],"59232":["Transect_160"],"61570":["Transect_161"],"64924":["Transect_162"],"64190":["Transect_163"],"62164":["Transect_164"],"61556":["Transect_165"],"61552":["Transect_166"],"60378":["Transect_167"],"59211":["Transect_168"],"59205":["Transect_169"],"60361":["Transect_170"],"57584":["Transect_171"],"55858":["Transect_172"],"55852":["Transect_173"],"55035":["Transect_174"],"57578":["Transect_175"],"58079":["Transect_176"],"59783":["Transect_177"],"58073":["Transect_178"],"55831":["Transect_179"],"52476":["Transect_180"],"49857":["Transect_181"],"46776":["Transect_182"],"50680":["Transect_183"],"52471":["Transect_184"],"55824":["Transect_185"],"55823":["Transect_186"],"57037":["Transect_187"],"55818":["Transect_188"],"55005":["Transect_189"],"52462":["Transect_190"],"51531":["Transect_191"],"49026":["Transect_192"],"48235":["Transect_193"],"46762":["Transect_194"],"45355":["Transect_195"],"43275":["Transect_196"],"41985":["Transect_197"],"40374":["Transect_198"],"39401":["Transect_199"],"38549":["Transect_200"],"37490":["Transect_201"],"37484":["Transect_202"],"37479":["Transect_203"],"37478":["Transect_204"],"38934":["Transect_205"],"39389":["Transect_206"],"38152":["Transect_207"],"37472":["Transect_208"],"38916":["Transect_209"],"40356":["Transect_210"],"40873":["Transect_211"],"42605":["Transect_212"],"43946":["Transect_213"],"45350":["Transect_214"],"46758":["Transect_215"],"49017":["Transect_216"],"51526":["Transect_217"],"55810":["Transect_218"],"57029":["Transect_219"],"56449":["Transect_220"],"56444":["Transect_221"],"57532":["Transect_222"],"57526":["Transect_223"],"54987":["Transect_224"],"49827":["Transect_225"],"48222":["Transect_226"],"46046":["Transect_227"],"45343":["Transect_228"],"43263":["Transect_229"],"41409":["Transect_230"],"41409":["Transect_231"],"40868":["Transect_232"],"39853":["Transect_233"],"38906":["Transect_234"],"40340":["Transect_235"],"40853":["Transect_236"],"41957":["Transect_237"],"41955":["Transect_238"],"42572":["Transect_239"],"41956":["Transect_240"],"45320":["Transect_241"],"45318":["Transect_242"],"45317":["Transect_243"],"43901":["Transect_244"],"43898":["Transect_245"],"43224":["Transect_246"],"41940":["Transect_247"],"41366":["Transect_248"],"41933":["Transect_249"],"41931":["Transect_250"],"41928":["Transect_251"],"41926":["Transect_252"],"41356":["Transect_253"],"42537":["Transect_254"],"41920":["Transect_255"],"41918":["Transect_256"],"42533":["Transect_257"],"43891":["Transect_258"],"45307":["Transect_259"],"49002":["Transect_260"],"45302":["Transect_261"],"44589":["Transect_262"],"46000":["Transect_263"],"43884":["Transect_264"],"41345":["Transect_265"],"40306":["Transect_266"],"38875":["Transect_267"],"37442":["Transect_268"],"35747":["Transect_269"],"35196":["Transect_270"],"34907":["Transect_271"],"34904":["Transect_272"],"34895":["Transect_273"],"31525":["Transect_274"],"28598":["Transect_275"],"28584":["Transect_276"],"31123":["Transect_277"],"33770":["Transect_278"],"33810":["Transect_279"],"34611":["Transect_280"],"35178":["Transect_281"],"36007":["Transect_282"],"36283":["Transect_283"],"37426":["Transect_284"],"38095":["Transect_285"],"38861":["Transect_286"],"40286":["Transect_287"],"42496":["Transect_288"],"41876":["Transect_289"],"40284":["Transect_290"],"41317":["Transect_291"],"41317":["Transect_292"],"41313":["Transect_293"],"40274":["Transect_294"],"40781":["Transect_295"],"40272":["Transect_296"],"40270":["Transect_297"],"40776":["Transect_298"],"42462":["Transect_299"],"43145":["Transect_300"],"43140":["Transect_301"],"43139":["Transect_302"],"43813":["Transect_303"],"108145":["Transect_304"]}
PARAMETERS = {"fort.63":"SWEL", "swan_TP.63":"TPS", "swan_HS.63":"HS"}


#------------------------------BEGIN SCRIPT----------------------------------#

def extract(parent_dir, inputfiles, storm_list, nodes_list):

    """Extracts data from ADCIRC time series files"""

    os.chdir(parent_dir)
    for root, dirs, files in os.walk(parent_dir):
        if root.rsplit('/', 1)[1] in storm_list:
            os.chdir(root)
            print(root)
            for filed in inputfiles:
                print("Extracting "+root+"/"+filed)
                f63 = os.path.join(root, filed)                 #-- 63 files
                with open(f63) as fin:
                    for line in fin:
                        mynode = line.strip().split(' ')[0]     #--Test each line
                        if mynode in nodes_list:
                            name = '{0}_node_{1}_{2}.txt'.format(nodes_list[mynode][0],
                                                                 mynode,
                                                                 PARAMETERS[filed])
                            f63_clip = os.path.join(root, name)
                            with open(f63_clip, 'a') as fout:     #-- If passes, write to file
                                fout.write(line.strip().split()[1]+"\n")

def main():

    """Main function, runs extract() funtion and times it."""

    start_time = dt.now()
    print('Begin extracting data:')
    print(start_time)

    extract(PARENT_DIR, INPUTFILES, STORM_LIST, NODES_LIST)

    end_time = dt.now()
    elapsed_time = end_time-start_time
    print("===========END========== \n")
    print("Processing Time : ")
    print(elapsed_time)

if __name__ == "__main__":
    main()
